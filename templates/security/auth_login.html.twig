{% extends 'base.html.twig' %}

{% block title %}Log in!{% endblock %}

{% block body %}
    <form id="authForm" action="{{ path('login') }}">
        <h1 class="h3 mb-3 font-weight-normal">Please Log in</h1>
        <label for="inputUsername">Username</label>
        <input type="text" name="username" id="inputUsername" class="form-control" required autofocus>
        <label for="inputPassword">Password</label>
        <input type="password" name="password" id="inputPassword" class="form-control" required>
        <button class="btn btn-lg btn-primary" type="submit">
            Log in
        </button>
    </form>
    or <a href="{{ path('register') }}">Register</a>
{% endblock %}

{% block javascripts %}
    <script>
        jQuery(document).submit(function(e){
            var form = jQuery(e.target);
            if(form.is("#authForm")){ // check if this is the form that you want (delete this check to apply this to all forms)
                e.preventDefault();
                jQuery.ajax({
                    type: "POST",
                    url: form.attr("action"),
                    data: form.serialize(), // serializes the form's elements.
                    success: function(data) {
                        // alert('Marko');
                        // console.log(data); // show response from the php script. (use the developer toolbar console, firefox firebug or chrome inspector console)?
                        localStorage.setItem('token',data.token);

                        var settings = {
                            "url": "{{ path('event_index') }}",
                            "method": "GET",
                            "timeout": 0,
                            "headers": {
                                "Authorization": localStorage.getItem('token')
                            },
                        };

                        $.ajax(settings).done(function (response) {
                            console.log(response);
                            window.location.replace('{{ path('calendar_index') }}');
                        });
                    }
                });
            }
        });
    </script>
{% endblock %}
